{% extends "admin/admin_base.html" %}

{% block title %}Seasons{% endblock %}

{% block content %}
<div class="max-w-6xl mx-auto">
  <div class="flex justify-between items-center mb-6">
    <h1 class="text-2xl font-semibold text-tcsc-navy">Seasons Management</h1>
    <div class="flex gap-3">
      <a href="{{ url_for('admin.get_admin_page') }}" class="bg-gray-200 text-gray-600 px-4 py-2 rounded-tcsc text-sm font-medium hover:bg-gray-300 transition-all">Back to Dashboard</a>
      <a href="{{ url_for('admin.new_season') }}" class="bg-tcsc-navy text-white px-4 py-2 rounded-tcsc text-sm font-medium hover:opacity-90 transition-all">Create New Season</a>
    </div>
  </div>

  <div class="bg-white rounded-md shadow-sm overflow-x-auto">
    <table class="w-full border-collapse min-w-[1200px]">
      <thead>
        <tr class="border-b border-tcsc-gray-100 bg-gray-50">
          <th class="text-left text-sm font-medium text-tcsc-gray-600 py-3 px-4">Name</th>
          <th class="text-left text-sm font-medium text-tcsc-gray-600 py-3 px-4">Status</th>
          <th class="text-left text-sm font-medium text-tcsc-gray-600 py-3 px-4">Type</th>
          <th class="text-left text-sm font-medium text-tcsc-gray-600 py-3 px-4">Year</th>
          <th class="text-left text-sm font-medium text-tcsc-gray-600 py-3 px-4">Dates</th>
          <th class="text-left text-sm font-medium text-tcsc-gray-600 py-3 px-4">Returning Registration</th>
          <th class="text-left text-sm font-medium text-tcsc-gray-600 py-3 px-4">New Registration</th>
          <th class="text-left text-sm font-medium text-tcsc-gray-600 py-3 px-4">Price</th>
          <th class="text-left text-sm font-medium text-tcsc-gray-600 py-3 px-4">Reg. Limit</th>
          <th class="text-left text-sm font-medium text-tcsc-gray-600 py-3 px-4">Description</th>
          <th class="text-left text-sm font-medium text-tcsc-gray-600 py-3 px-4">Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for season in seasons %}
        <tr class="border-b border-tcsc-gray-100 hover:bg-gray-50 transition-colors">
          <td class="py-3 px-4 text-sm text-tcsc-navy font-medium">{{ season.name }}</td>
          <td class="py-3 px-4 text-sm">
            {% if season.is_current %}
              <span class="inline-flex items-center px-2 py-0.5 rounded-md text-xs font-medium bg-green-500/15 text-green-700">Current</span>
            {% else %}
              <span class="inline-flex items-center px-2 py-0.5 rounded-md text-xs font-medium bg-zinc-600/10 text-zinc-700">&mdash;</span>
            {% endif %}
          </td>
          <td class="py-3 px-4 text-sm text-tcsc-gray-800">{{ season.season_type }}</td>
          <td class="py-3 px-4 text-sm text-tcsc-gray-800">{{ season.year }}</td>
          <td class="py-3 px-4 text-sm text-tcsc-gray-800">{{ season.start_date.strftime('%Y-%m-%d') }} to {{ season.end_date.strftime('%Y-%m-%d') }}</td>
          <td class="py-3 px-4 text-sm text-tcsc-gray-600">
            {% if season.returning_start and season.returning_end %}
              {{ season.returning_start.strftime('%Y-%m-%d %H:%M') }}<br>to<br>{{ season.returning_end.strftime('%Y-%m-%d %H:%M') }}
            {% else %}
              <span class="text-tcsc-gray-400">&mdash;</span>
            {% endif %}
          </td>
          <td class="py-3 px-4 text-sm text-tcsc-gray-600">
            {% if season.new_start and season.new_end %}
              {{ season.new_start.strftime('%Y-%m-%d %H:%M') }}<br>to<br>{{ season.new_end.strftime('%Y-%m-%d %H:%M') }}
            {% else %}
              <span class="text-tcsc-gray-400">&mdash;</span>
            {% endif %}
          </td>
          <td class="py-3 px-4 text-sm text-tcsc-gray-800">
            {% if season.price_cents %}
              ${{ '%.2f'|format(season.price_cents/100) }}
            {% else %}
              <span class="text-tcsc-gray-400">&mdash;</span>
            {% endif %}
          </td>
          <td class="py-3 px-4 text-sm text-tcsc-gray-800">
            {% if season.registration_limit %}
              {{ season.registration_limit }}
            {% else %}
              <span class="text-tcsc-gray-400">&mdash;</span>
            {% endif %}
          </td>
          <td class="py-3 px-4 text-sm text-tcsc-gray-600">
            {% if season.description %}
              {{ season.description|truncate(60) }}
            {% else %}
              <span class="text-tcsc-gray-400">&mdash;</span>
            {% endif %}
          </td>
          <td class="py-3 px-4 text-sm">
            <div class="flex flex-wrap gap-2">
              <a href="{{ url_for('admin.edit_season', season_id=season.id) }}" class="bg-tcsc-navy text-white px-3 py-1.5 rounded-tcsc text-xs font-medium hover:opacity-90 transition-all">Edit</a>
              <a href="{{ url_for('admin.export_season_members', season_id=season.id) }}" class="bg-tcsc-navy text-white px-3 py-1.5 rounded-tcsc text-xs font-medium hover:opacity-90 transition-all">Export</a>
              {% if not season.is_current %}
              <form action="{{ url_for('admin.activate_season', season_id=season.id) }}" method="POST" class="inline">
                <button type="submit" class="bg-status-success-bg text-status-success-text px-3 py-1.5 rounded-tcsc text-xs font-medium hover:bg-green-200 transition-all" onclick="return confirm('Activate season &quot;{{ season.name }}&quot;?\n\nThis will:\n• Set this as the current season\n• Update all user statuses based on their registration\n• Recalculate seasons_since_active counters\n\nContinue?')">
                  Activate
                </button>
              </form>
              {% endif %}
              <button
                class="bg-status-error-bg text-status-error-text px-3 py-1.5 rounded-tcsc text-xs font-medium hover:bg-red-200 transition-all"
                onclick="confirmDelete('season', '{{ season.id }}', '{{ season.name }}')"
              >
                Delete
              </button>
            </div>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %}
