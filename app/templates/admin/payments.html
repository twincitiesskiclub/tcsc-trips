{% extends 'admin/admin_base.html' %}
{% block extra_css %}
<style>
/* Bulk Summary in Modal */
.bulk-summary {
    display: flex;
    gap: 24px;
    margin: 16px 0;
    padding: 16px;
    background: #f9fafb;
    border-radius: 8px;
}

.summary-stat {
    display: flex;
    flex-direction: column;
    align-items: center;
}

.stat-value {
    font-size: 24px;
    font-weight: 600;
    color: #1c2c44;
}

.stat-label {
    font-size: 12px;
    color: #667085;
    margin-top: 4px;
}

.payment-list {
    max-height: 200px;
    overflow-y: auto;
    border: 1px solid #e4e7ec;
    border-radius: 6px;
    margin-top: 12px;
}

.payment-item {
    padding: 8px 12px;
    border-bottom: 1px solid #e4e7ec;
    font-size: 13px;
}

.payment-item:last-child {
    border-bottom: none;
}

/* Hidden amounts */
.amount-hidden {
    color: #98a2b3;
    font-style: italic;
}
</style>
{% endblock %}

{% block content %}
<div class="bg-white rounded-tcsc p-5">
    <h1 class="text-xl font-semibold text-tcsc-navy mb-3">Payments</h1>

    <!-- Toolbar -->
    <div class="flex items-center gap-2.5 mb-4 flex-nowrap">
        <input type="text" id="payments-search" class="tbl-search" placeholder="Search...">
        <select id="type-filter" class="tbl-select">
            <option value="">All Types</option>
            <option value="trip">Trip</option>
            <option value="season">Season</option>
        </select>
        <select id="status-filter" class="tbl-select">
            <option value="">All Statuses</option>
            <option value="pending">Pending</option>
            <option value="success">Success</option>
            <option value="refunded">Refunded</option>
            <option value="canceled">Canceled</option>
        </select>
        <span id="payment-count" class="h-8 inline-flex items-center px-3 bg-gray-100 border border-gray-200 rounded-md text-sm font-medium text-gray-600 whitespace-nowrap">0 payments</span>
        <div class="flex-1"></div>
        <div class="flex gap-2 items-center">
            <button id="bulk-accept" class="toolbar-btn toolbar-btn-success" disabled>Accept Selected</button>
            <button id="bulk-refund" class="toolbar-btn toolbar-btn-danger" disabled>Refund Selected</button>
        </div>
    </div>

    <div id="payments-table" class="tabulator-data"></div>

    <div class="flex justify-end mt-4 pt-4 border-t border-gray-200">
        <button id="export-csv" class="toolbar-btn toolbar-btn-secondary">Export CSV</button>
    </div>
</div>

<!-- Bulk Action Confirmation Modal -->
<div id="bulk-modal" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50" style="display: none;">
    <div class="absolute inset-0"></div>
    <div class="relative bg-white rounded-tcsc w-full max-w-md mx-4 shadow-xl">
        <div class="flex items-center justify-between p-5 border-b border-tcsc-gray-100">
            <h2 id="modal-title" class="text-lg font-semibold text-tcsc-navy">Confirm Action</h2>
            <button class="text-2xl text-gray-400 hover:text-gray-600 leading-none modal-close">&times;</button>
        </div>
        <div class="p-5" id="modal-body">
            <!-- Dynamic content -->
        </div>
        <div class="flex justify-end gap-3 p-5 border-t border-tcsc-gray-100">
            <button type="button" class="bg-gray-200 text-gray-600 px-4 py-2 rounded-tcsc text-sm font-medium hover:bg-gray-300 transition-all" id="cancel-action">Cancel</button>
            <button type="button" class="bg-green-100 text-green-700 px-4 py-2 rounded-tcsc text-sm font-medium hover:bg-green-200 transition-all" id="confirm-action">Confirm</button>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='admin_payments.js') }}?v={{ range(1000000) | random }}"></script>
{% endblock %}
