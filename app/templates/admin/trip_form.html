{% extends 'admin/admin_base.html' %}

{% block title %}{{ 'Edit Trip' if trip else 'New Trip' }}{% endblock %}

{% block content %}
<div class="flex items-center justify-between mb-6 flex-wrap gap-4">
    <h1 class="text-2xl font-semibold text-tcsc-navy m-0">{{ 'Edit Trip' if trip else 'New Trip' }}</h1>
    <a href="{{ url_for('admin.get_admin_trips') }}" class="bg-gray-200 text-gray-600 px-4 py-3 rounded-tcsc text-sm font-medium hover:bg-gray-300 transition-all">Back to Trips</a>
</div>

<form class="bg-white p-6 rounded-tcsc border border-tcsc-gray-100" method="POST">
    <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
        <div class="mb-5">
            <label for="name" class="block text-sm font-medium text-tcsc-gray-800 mb-2">Trip Name</label>
            <input type="text" id="name" name="name" value="{{ trip.name if trip else '' }}" required
                   class="w-full px-3 py-2 border border-tcsc-gray-100 rounded-tcsc text-sm focus:outline-none focus:ring-2 focus:ring-tcsc-navy/20 focus:border-tcsc-navy">
        </div>
        <div class="mb-5">
            <label for="slug" class="block text-sm font-medium text-tcsc-gray-800 mb-2">Trip Slug</label>
            <input type="text" id="slug" name="slug" value="{{ trip.slug if trip else '' }}" required
                   pattern="[a-z0-9-]+" title="Only lowercase letters, numbers, and hyphens allowed"
                   {% if trip %}readonly{% endif %}
                   class="w-full px-3 py-2 border border-tcsc-gray-100 rounded-tcsc text-sm focus:outline-none focus:ring-2 focus:ring-tcsc-navy/20 focus:border-tcsc-navy {% if trip %}bg-gray-100 cursor-not-allowed{% endif %}">
        </div>
    </div>

    <div class="mb-5">
        <label for="destination" class="block text-sm font-medium text-tcsc-gray-800 mb-2">Destination</label>
        <input type="text" id="destination" name="destination" value="{{ trip.destination if trip else '' }}" required
               class="w-full px-3 py-2 border border-tcsc-gray-100 rounded-tcsc text-sm focus:outline-none focus:ring-2 focus:ring-tcsc-navy/20 focus:border-tcsc-navy">
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
        <div class="mb-5">
            <label for="max_participants_standard" class="block text-sm font-medium text-tcsc-gray-800 mb-2">Standard Capacity</label>
            <input type="number" id="max_participants_standard" name="max_participants_standard"
                   value="{{ trip.max_participants_standard if trip else '' }}" required
                   class="w-full px-3 py-2 border border-tcsc-gray-100 rounded-tcsc text-sm focus:outline-none focus:ring-2 focus:ring-tcsc-navy/20 focus:border-tcsc-navy">
        </div>
        <div class="mb-5">
            <label for="max_participants_extra" class="block text-sm font-medium text-tcsc-gray-800 mb-2">Extra Capacity</label>
            <input type="number" id="max_participants_extra" name="max_participants_extra"
                   value="{{ trip.max_participants_extra if trip else '' }}" required
                   class="w-full px-3 py-2 border border-tcsc-gray-100 rounded-tcsc text-sm focus:outline-none focus:ring-2 focus:ring-tcsc-navy/20 focus:border-tcsc-navy">
        </div>
    </div>

    <div class="mb-5">
        <label class="flex items-center gap-2 text-sm font-medium text-tcsc-navy cursor-pointer">
            <input type="checkbox" id="single-price" name="single-price" class="w-4 h-4 rounded border-tcsc-gray-100 text-tcsc-navy focus:ring-tcsc-navy/20">
            Single Price Point
        </label>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-5" id="price-inputs">
        <div class="mb-5">
            <label for="price_low" id="price-label" class="block text-sm font-medium text-tcsc-gray-800 mb-2">Lower Price ($)</label>
            <input type="number" id="price_low" name="price_low" step="0.01"
                   value="{{ '%.2f'|format(trip.price_low / 100) if trip else '' }}" required
                   class="w-full px-3 py-2 border border-tcsc-gray-100 rounded-tcsc text-sm focus:outline-none focus:ring-2 focus:ring-tcsc-navy/20 focus:border-tcsc-navy">
        </div>
        <div class="mb-5" id="price-high-group">
            <label for="price_high" class="block text-sm font-medium text-tcsc-gray-800 mb-2">Higher Price ($)</label>
            <input type="number" id="price_high" name="price_high" step="0.01"
                   value="{{ '%.2f'|format(trip.price_high / 100) if trip else '' }}" required
                   class="w-full px-3 py-2 border border-tcsc-gray-100 rounded-tcsc text-sm focus:outline-none focus:ring-2 focus:ring-tcsc-navy/20 focus:border-tcsc-navy">
        </div>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
        <div class="mb-5">
            <label for="start_date" class="block text-sm font-medium text-tcsc-gray-800 mb-2">Start Date</label>
            <input type="date" id="start_date" name="start_date"
                   value="{{ trip.start_date.strftime('%Y-%m-%d') if trip else '' }}" required
                   class="w-full px-3 py-2 border border-tcsc-gray-100 rounded-tcsc text-sm focus:outline-none focus:ring-2 focus:ring-tcsc-navy/20 focus:border-tcsc-navy">
        </div>
        <div class="mb-5">
            <label for="end_date" class="block text-sm font-medium text-tcsc-gray-800 mb-2">End Date</label>
            <input type="date" id="end_date" name="end_date"
                   value="{{ trip.end_date.strftime('%Y-%m-%d') if trip else '' }}" required
                   class="w-full px-3 py-2 border border-tcsc-gray-100 rounded-tcsc text-sm focus:outline-none focus:ring-2 focus:ring-tcsc-navy/20 focus:border-tcsc-navy">
        </div>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
        <div class="mb-5">
            <label for="signup_start" class="block text-sm font-medium text-tcsc-gray-800 mb-2">Signup Start</label>
            <input type="datetime-local" id="signup_start" name="signup_start"
                   value="{{ trip.signup_start.strftime('%Y-%m-%dT%H:%M') if trip else '' }}" required
                   class="w-full px-3 py-2 border border-tcsc-gray-100 rounded-tcsc text-sm focus:outline-none focus:ring-2 focus:ring-tcsc-navy/20 focus:border-tcsc-navy">
        </div>
        <div class="mb-5">
            <label for="signup_end" class="block text-sm font-medium text-tcsc-gray-800 mb-2">Signup End</label>
            <input type="datetime-local" id="signup_end" name="signup_end"
                   value="{{ trip.signup_end.strftime('%Y-%m-%dT%H:%M') if trip else '' }}" required
                   class="w-full px-3 py-2 border border-tcsc-gray-100 rounded-tcsc text-sm focus:outline-none focus:ring-2 focus:ring-tcsc-navy/20 focus:border-tcsc-navy">
        </div>
    </div>

    <div class="mb-5">
        <label for="description" class="block text-sm font-medium text-tcsc-gray-800 mb-2">Description</label>
        <textarea id="description" name="description" rows="4" required
                  class="w-full px-3 py-2 border border-tcsc-gray-100 rounded-tcsc text-sm focus:outline-none focus:ring-2 focus:ring-tcsc-navy/20 focus:border-tcsc-navy resize-y">{{ trip.description if trip else '' }}</textarea>
    </div>

    <div class="mb-5">
        <label for="status" class="block text-sm font-medium text-tcsc-gray-800 mb-2">Status</label>
        <select id="status" name="status" required
                class="w-full px-3 py-2 border border-tcsc-gray-100 rounded-tcsc text-sm focus:outline-none focus:ring-2 focus:ring-tcsc-navy/20 focus:border-tcsc-navy">
            <option value="draft" {% if trip and trip.status == 'draft' %}selected{% endif %}>Draft</option>
            <option value="active" {% if trip and trip.status == 'active' %}selected{% endif %}>Active</option>
            <option value="completed" {% if trip and trip.status == 'completed' %}selected{% endif %}>Completed</option>
            <option value="canceled" {% if trip and trip.status == 'canceled' %}selected{% endif %}>Cancelled</option>
        </select>
    </div>

    <div class="flex gap-3 mt-6">
        <button type="submit" class="bg-tcsc-navy text-white px-6 py-3 rounded-tcsc text-sm font-medium hover:opacity-90 transition-all">Save Trip</button>
        <a href="{{ url_for('admin.get_admin_trips') }}" class="bg-gray-200 text-gray-600 px-6 py-3 rounded-tcsc text-sm font-medium hover:bg-gray-300 transition-all">Cancel</a>
    </div>
</form>
{% endblock %}
